<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript—Event loop | xcc</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo/profile2.png">
    <meta name="description" content="JavaScript 有一个基于事件循环的运行时模型，它负责执行代码、收集和处理事件以及执行排队的子任务.">
    
    <link rel="preload" href="/assets/css/0.styles.3443fe78.css" as="style"><link rel="preload" href="/assets/js/app.bed702ed.js" as="script"><link rel="preload" href="/assets/js/6.b946c0f4.js" as="script"><link rel="preload" href="/assets/js/3.e8e39a4f.js" as="script"><link rel="preload" href="/assets/js/27.1001651b.js" as="script"><link rel="prefetch" href="/assets/js/10.17e833a5.js"><link rel="prefetch" href="/assets/js/11.f4383e7a.js"><link rel="prefetch" href="/assets/js/12.6650d2ae.js"><link rel="prefetch" href="/assets/js/13.c14d97f9.js"><link rel="prefetch" href="/assets/js/14.995877c6.js"><link rel="prefetch" href="/assets/js/15.d67fc335.js"><link rel="prefetch" href="/assets/js/16.2b768f7e.js"><link rel="prefetch" href="/assets/js/17.34e25cc9.js"><link rel="prefetch" href="/assets/js/18.b2ef20f0.js"><link rel="prefetch" href="/assets/js/19.a51670c2.js"><link rel="prefetch" href="/assets/js/20.615a6b6f.js"><link rel="prefetch" href="/assets/js/21.1171e8a2.js"><link rel="prefetch" href="/assets/js/22.211b4d0f.js"><link rel="prefetch" href="/assets/js/23.098e99fd.js"><link rel="prefetch" href="/assets/js/24.80526b1f.js"><link rel="prefetch" href="/assets/js/25.282351a4.js"><link rel="prefetch" href="/assets/js/26.149c9a0a.js"><link rel="prefetch" href="/assets/js/28.a5c8c99b.js"><link rel="prefetch" href="/assets/js/29.d4009700.js"><link rel="prefetch" href="/assets/js/30.b14d5131.js"><link rel="prefetch" href="/assets/js/31.2dc47162.js"><link rel="prefetch" href="/assets/js/32.51d4fe61.js"><link rel="prefetch" href="/assets/js/33.279b4c95.js"><link rel="prefetch" href="/assets/js/34.2122be4e.js"><link rel="prefetch" href="/assets/js/4.e8fce9c7.js"><link rel="prefetch" href="/assets/js/5.7bf97a98.js"><link rel="prefetch" href="/assets/js/7.7d46e129.js"><link rel="prefetch" href="/assets/js/8.8d71c747.js"><link rel="prefetch" href="/assets/js/9.2f7cc487.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.1f3cd5b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3443fe78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">xcc </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="https://rebel-writer-12b.notion.site/Leet-Code-2f6793a3398442778907d14919a6cb07" target="_blank" rel="noopener noreferrer" class="nav-link external">LeetCode</a></li><li class="nav-item"><a href="https://rebel-writer-12b.notion.site/Engineering-Wiki-6f04c16f81ed4fbd8f6d599237c98dfe" target="_blank" rel="noopener noreferrer" class="nav-link external">Notions</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">xcc </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="https://rebel-writer-12b.notion.site/Leet-Code-2f6793a3398442778907d14919a6cb07" target="_blank" rel="noopener noreferrer" class="nav-link external">LeetCode</a></li><li class="mobile-nav-item"><a href="https://rebel-writer-12b.notion.site/Engineering-Wiki-6f04c16f81ed4fbd8f6d599237c98dfe" target="_blank" rel="noopener noreferrer" class="nav-link external">Notions</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        JavaScript—Event loop
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">xucongcong</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2022-03-01T00:00:00.000Z">
      2022-03-01
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-532d3a9c><a href="/tag/JavaScript" data-v-532d3a9c><span data-v-532d3a9c>JavaScript</span></a></li><li class="post-tag" data-v-532d3a9c><a href="/tag/Node" data-v-532d3a9c><span data-v-532d3a9c>Node</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><blockquote><p>JavaScript 有一个基于事件循环的运行时模型，它负责执行代码、收集和处理事件以及执行排队的子任务。该模型与 C 和 Java 等其他语言中的模型有很大不同。
--MDN</p></blockquote> <p>本文将学习 NodeJS 的基本工作原理以及同步或异步代码的执行过程。</p> <h2 id="_1-什么是事件循环"><a href="#_1-什么是事件循环" class="header-anchor">#</a> 1. 什么是事件循环？</h2> <p>事件循环（event loop）是一个事件监听器，它在 NodeJS 环境中运行，随时准备监听、处理和输出事件。</p> <p>事件可以是鼠标单击、按键或超时等任何事件。</p> <br> <h2 id="_2-什么是同步和异步编程"><a href="#_2-什么是同步和异步编程" class="header-anchor">#</a> 2. 什么是同步和异步编程？</h2> <p>同步编程意味着代码按照定义的顺序运行。程序就是按照代码的顺序一行一行执行的。</p> <p>对于异步编程，先看一个例子：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>

<span class="token comment">//----------------</span>
start
Hello World
</code></pre></div><p>这些函数调用不会逐行运行，而是仅在需要时运行，与函数的声明顺序无关。在上面例子中，当所有同步函数都执行完毕后，setTimeOut里面的函数会在 3 秒后自动运行。</p> <p>💡 注意：异步调用的内容只有在所有同步调用都执行完毕后才会执行，它们将在后台被处理。</p> <p>NodeJS是如何先运行所有同步调用，并在后台处理异步调用的呢？所有这些机制都可以通过 NodeJS 事件循环轻松解释。</p> <br> <h2 id="_3-事件循环是如何工作的"><a href="#_3-事件循环是如何工作的" class="header-anchor">#</a> 3. 事件循环是如何工作的？</h2> <br> <h3 id="_3-1-同步代码的执行过程"><a href="#_3-1-同步代码的执行过程" class="header-anchor">#</a> 3.1 同步代码的执行过程</h3> <p>我们先看看NodeJS事件循环如何执行一个简单的同步程序，然后我们将逐行测试Node是如何执行程序的</p> <center><img src="/2022-1/eventloop0.png" style="zoom:70%;"></center> <p>左上角是代码，左下角是控制台输出，除此之外还有函数调用栈、Node API、回调函数队列，这大体就是NodeJS的执行环境。</p> <p>当程序开始执行时，它首先被包裹在一个匿名的 main() 函数中。这是由 NodeJS 自动定义的。所以 main() 首先被推送到回调堆栈</p> <center><img src="/2022-1/eventloop1.png" style="zoom:60%;"></center> <p>接下来，创建变量 a 和 b，并将它们的和存储在变量 sum 中。所有这些值都存储在内存中。</p> <p>然后，console.log() 在回调堆栈中被调用和推送。在终端屏幕上输出结果。</p> <center><img src="/2022-1/eventloop2.png" style="zoom:60%;"></center> <p>console.log()函数执行后，将从回调堆栈中删除。然后由于没有任何东西可以从程序中调用，所以main() 也被删除，这就是同步程序的执行方式。</p> <center><img src="/2022-1/eventloop3.png" style="zoom:60%;"></center> <br> <center><img src="/2022-1/eventloop4.png" style="zoom:60%;"></center> <h3 id="_3-2-异步代码的执行过程"><a href="#_3-2-异步代码的执行过程" class="header-anchor">#</a> 3.2 异步代码的执行过程</h3> <p>现在，再看看如何在 NodeJS 中执行异步函数调用：</p> <center><img src="/2022-1/eventloop5.png" style="zoom:60%;"></center> <p>同样的，当程序开始执行时，首先将 main() 函数添加到回调堆栈中，然后 console.log(&quot;Start&quot;) 被调用并添加到函数调用栈中，执行完成后会从函数调用栈中被释放：</p> <center><img src="/2022-1/eventloop6.png" style="zoom:60%;"></center> <br> <center><img src="/2022-1/eventloop7.png" style="zoom:60%;"></center> <p>下一个是添加到回调堆栈的 setTimeOut() 函数，但由于这是一个异步函数，它不会在回调堆栈中得到处理。而是被添加到Node API中，在该 API 中注册事件并设置回调函数以在后台处理：</p> <center><img src="/2022-1/eventloop8.png" style="zoom:60%;"></center> <br> <center><img src="/2022-1/eventloop9.png" style="zoom:60%;"></center> <p>接下来还是一个setTimeOut() 函数，也会被添加到Node API中，不过这个会在2秒后才被执行。</p> <center><img src="/2022-1/eventloop10.png" style="zoom:60%;"></center> <br> <center><img src="/2022-1/eventloop11.png" style="zoom:60%;"></center> <p>然后就是console.log()执行同步打印，接下来，所有同步函数都已处理完毕，main() 从调用栈中删除。</p> <center><img src="/2022-1/eventloop12.png" style="zoom:60%;"></center> <p>main() 从调用栈中被删除后，在后台，所有异步函数都得到处理，它们的回调存储在回调队列中，在event loop的驱动下得到执行：</p> <center><img src="/2022-1/eventloop13.png" style="zoom:60%;"></center> <br> <center><img src="/2022-1/eventloop14.png" style="zoom:60%;"></center> <br> <center><img src="/2022-1/eventloop15.png" style="zoom:60%;"></center> <p>最后，这些在执行后也被删除，现在回调堆栈为空：</p> <center><img src="/2022-1/eventloop16.png" style="zoom:60%;"></center> <p>这就是 NodeJS 环境中下执行同步和异步函数的基本过程。</p> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" target="_blank" rel="noopener noreferrer">The event loop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.freecodecamp.org/news/nodejs-eventloop-tutorial/" target="_blank" rel="noopener noreferrer">Event Loops in NodeJS - Beginner's Guide to Synchronous and Asynchronous Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#_1-什么是事件循环" title="1. 什么是事件循环？">1. 什么是事件循环？</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_2-什么是同步和异步编程" title="2. 什么是同步和异步编程？">2. 什么是同步和异步编程？</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_3-事件循环是如何工作的" title="3. 事件循环是如何工作的？">3. 事件循环是如何工作的？</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-1-同步代码的执行过程" title="3.1 同步代码的执行过程">3.1 同步代码的执行过程</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_3-2-异步代码的执行过程" title="3.2 异步代码的执行过程">3.2 异步代码的执行过程</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#参考文档" title="参考文档">参考文档</a></div></div></div></div> <footer class="footer" data-v-8eb634d6><div class="footer-left-wrap" data-v-8eb634d6><ul class="contact" data-v-8eb634d6><li class="contact-item" data-v-8eb634d6><a href="https://github.com/awesomexu" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-8eb634d6><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-8eb634d6><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-8eb634d6></path></svg>
          
        </a></li><li class="contact-item" data-v-8eb634d6><a href="mailto:xcc_mail@qq.com" class="nav-link external" data-v-8eb634d6><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-8eb634d6><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-8eb634d6></path><polyline points="22,6 12,13 2,6" data-v-8eb634d6></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-8eb634d6><ul class="copyright" data-v-8eb634d6><li class="copyright-item" data-v-8eb634d6><a href="https://policies.google.com/privacy?hl=en-US" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-8eb634d6>Privacy Policy</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bed702ed.js" defer></script><script src="/assets/js/6.b946c0f4.js" defer></script><script src="/assets/js/3.e8e39a4f.js" defer></script><script src="/assets/js/27.1001651b.js" defer></script>
  </body>
</html>
