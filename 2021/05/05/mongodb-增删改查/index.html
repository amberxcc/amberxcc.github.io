<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB—增删改查 | xcc</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo/profile2.png">
    <meta name="description" content="MongoDB CRUD basic.">
    
    <link rel="preload" href="/assets/css/0.styles.3443fe78.css" as="style"><link rel="preload" href="/assets/js/app.2dcd9c50.js" as="script"><link rel="preload" href="/assets/js/6.b946c0f4.js" as="script"><link rel="preload" href="/assets/js/3.ef868f41.js" as="script"><link rel="preload" href="/assets/js/36.30f68b02.js" as="script"><link rel="prefetch" href="/assets/js/10.17e833a5.js"><link rel="prefetch" href="/assets/js/11.f4383e7a.js"><link rel="prefetch" href="/assets/js/12.85e02cea.js"><link rel="prefetch" href="/assets/js/13.1284aa63.js"><link rel="prefetch" href="/assets/js/14.333d44b4.js"><link rel="prefetch" href="/assets/js/15.dc3a9998.js"><link rel="prefetch" href="/assets/js/16.852ea923.js"><link rel="prefetch" href="/assets/js/17.75da275c.js"><link rel="prefetch" href="/assets/js/18.9336a1d7.js"><link rel="prefetch" href="/assets/js/19.5dc29560.js"><link rel="prefetch" href="/assets/js/20.740afe88.js"><link rel="prefetch" href="/assets/js/21.5899f657.js"><link rel="prefetch" href="/assets/js/22.2bc4fd97.js"><link rel="prefetch" href="/assets/js/23.b852b847.js"><link rel="prefetch" href="/assets/js/24.08aa5266.js"><link rel="prefetch" href="/assets/js/25.7fc257fe.js"><link rel="prefetch" href="/assets/js/26.d7727736.js"><link rel="prefetch" href="/assets/js/27.24c389ab.js"><link rel="prefetch" href="/assets/js/28.df1b55ec.js"><link rel="prefetch" href="/assets/js/29.3706b438.js"><link rel="prefetch" href="/assets/js/30.02d6775e.js"><link rel="prefetch" href="/assets/js/31.6c3d79a3.js"><link rel="prefetch" href="/assets/js/32.97ed12c2.js"><link rel="prefetch" href="/assets/js/33.f9005490.js"><link rel="prefetch" href="/assets/js/34.25b1f542.js"><link rel="prefetch" href="/assets/js/35.9c8d3bd7.js"><link rel="prefetch" href="/assets/js/37.a531d4d2.js"><link rel="prefetch" href="/assets/js/38.e53ca0bc.js"><link rel="prefetch" href="/assets/js/39.b5d79522.js"><link rel="prefetch" href="/assets/js/4.79e6303a.js"><link rel="prefetch" href="/assets/js/5.7bf97a98.js"><link rel="prefetch" href="/assets/js/7.7d46e129.js"><link rel="prefetch" href="/assets/js/8.8d71c747.js"><link rel="prefetch" href="/assets/js/9.2f7cc487.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.1f3cd5b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3443fe78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">xcc </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="https://rebel-writer-12b.notion.site/Leet-Code-2f6793a3398442778907d14919a6cb07" target="_blank" rel="noopener noreferrer" class="nav-link external">LeetCode</a></li><li class="nav-item"><a href="https://rebel-writer-12b.notion.site/Engineering-Wiki-6f04c16f81ed4fbd8f6d599237c98dfe" target="_blank" rel="noopener noreferrer" class="nav-link external">Notions</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">xcc </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="https://rebel-writer-12b.notion.site/Leet-Code-2f6793a3398442778907d14919a6cb07" target="_blank" rel="noopener noreferrer" class="nav-link external">LeetCode</a></li><li class="mobile-nav-item"><a href="https://rebel-writer-12b.notion.site/Engineering-Wiki-6f04c16f81ed4fbd8f6d599237c98dfe" target="_blank" rel="noopener noreferrer" class="nav-link external">Notions</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        MongoDB—增删改查
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">xucongcong</span> <!----></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2021-05-05T00:00:00.000Z">
      2021-05-05
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-532d3a9c><a href="/tag/MongoDB" data-v-532d3a9c><span data-v-532d3a9c>MongoDB</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="_1-添加数据"><a href="#_1-添加数据" class="header-anchor">#</a> 1. 添加数据</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 插入单个数据 =&gt; 返回插入后的文档_id</span>
db.collection.insertOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 插入多个数据 =&gt; 返回插入后的文档_id</span>
db.collection.insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token punctuation">..</span>.<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 插入单个或多个 =&gt; 不返回_id，只显示成功个数</span>
db.collection.insert<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>💡 插入的文档数据默认自动添加主键字段_id</p> <blockquote><p>在 MongoDB 3.0 之前，insert 是在 MongoDB 中插入文档的主要方法。虽然 insert 等方法仍然支持向后兼容，但今后不应该在应用程序中继续使用。<strong>应该使用 insertOne 和 insertMany</strong> 。</p></blockquote> <br> <h2 id="_2-删除数据"><a href="#_2-删除数据" class="header-anchor">#</a> 2. 删除数据</h2> <ul><li><code>db.collection.deleteMany()</code>：删除查询到的多个文档</li> <li><code>db.collection.deleteOne()</code>：删除查询到的单个文档</li></ul> <blockquote><p>在 MongoDB 3.0 之前，remove 是删除文档的主要方法</p></blockquote> <br> <h2 id="_3-更新数据"><a href="#_3-更新数据" class="header-anchor">#</a> 3. 更新数据</h2> <blockquote><p>更新文档是原子操作：如果两个更新同时发生，那么首先到达服务器的更新会先被执行， 然后再执行下一个更新。因此，相互冲突的更新可以安全地迅速接连完成，而不会破坏任何文档：最后一次更新将“成功”。如果不想使用默认行为，则可以考虑使用文档版本控制模式。</p></blockquote> <ul><li><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></li> <li><code>db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></li> <li><code>db.collection.replaceOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 更新单个文档</span>
db.inventory.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;item&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;paper&quot;</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span>
     <span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;size.uom&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cm&quot;</span>, <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;P&quot;</span> <span class="token punctuation">}</span>,
     <span class="token variable">$currentDate</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;lastModified&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment"># 更新多个文档</span>
db.inventory.updateMany<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;qty&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">50</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span>
     <span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;size.uom&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;in&quot;</span>, <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;P&quot;</span> <span class="token punctuation">}</span>,
     <span class="token variable">$currentDate</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;lastModified&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment"># 直接替换文档</span>
db.inventory.replaceOne<span class="token punctuation">(</span><span class="token punctuation">{</span> item: <span class="token string">&quot;paper&quot;</span> <span class="token punctuation">}</span>,
   <span class="token punctuation">{</span> item: <span class="token string">&quot;paper&quot;</span>, instock: <span class="token punctuation">[</span> <span class="token punctuation">{</span> warehouse: <span class="token string">&quot;A&quot;</span>, qty: <span class="token number">60</span> <span class="token punctuation">}</span>, <span class="token punctuation">{</span> warehouse: <span class="token string">&quot;B&quot;</span>, qty: <span class="token number">40</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>updateOne/updateMany要求<code>&lt;update&gt;</code>部分必须具有修改操作符，否则报错：</p> <ul><li>$set：设置一个字段的值。如果这个字段不存在，则创建该字段</li> <li>$unset：删除文档中的某个字段</li> <li>$inc：递增已存在的键值或者在该键不存在时创建它（只能操作数字）</li> <li>$push：将元素添加到数组末尾；如果数组不存在， 则会创建一个新的数组</li> <li>$pushAll：增加多个对象到数组底部</li> <li>$pop：从数组底部或顶部弹出一个对象</li> <li>$pull：从数组中删除指定元素（如果存在的话）</li> <li>$pullAll：如果匹配任意的值，从数据中删除相应的对象</li> <li>$addToSet：将数组作为一个set使用，如果不存在则增加到数组</li> <li>$currentDate：将字段的值设置为当前日期，可以是日期或时间戳（默认是日期）</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xcc&quot;</span><span class="token punctuation">}</span>, 
<span class="token punctuation">{</span><span class="token variable">$push</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;skill&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mongodb&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># $push可以配合$each，一次向数组中添加多个数据</span>
$ db.stock.ticker.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;GOOG&quot;</span><span class="token punctuation">}</span>,
<span class="token punctuation">{</span><span class="token string">&quot;<span class="token variable">$push</span>&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;hourly&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;<span class="token variable">$each</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">562.776</span>, <span class="token number">562.790</span>, <span class="token number">559.123</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 &quot;$slice&quot; 修饰符配合 $push可以截断数组，下例限制了数组只包含最后加入的3个元素（队列）</span>
<span class="token comment"># slice切片前还可以先根据某字段排序</span>
db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xcc&quot;</span><span class="token punctuation">}</span>, 
<span class="token punctuation">{</span><span class="token variable">$push</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;skill&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$each</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;b&quot;</span>,<span class="token string">&quot;a&quot;</span>,<span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;2&quot;</span>,<span class="token string">&quot;3&quot;</span><span class="token punctuation">]</span>, <span class="token variable">$slice</span><span class="token builtin class-name">:</span> -3<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># $addToSet 也可以配合$each批量添加</span>
<span class="token operator">&gt;</span> db.users.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;4b2d75476cc613d5ee930164&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span>, 
<span class="token punctuation">{</span><span class="token string">&quot;<span class="token variable">$addToSet</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;emails&quot;</span> <span class="token builtin class-name">:</span> 
<span class="token punctuation">{</span><span class="token string">&quot;<span class="token variable">$each</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;joe@php.net&quot;</span>, <span class="token string">&quot;joe@example.com&quot;</span>, <span class="token string">&quot;joe@python.org&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db.user.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xcc&quot;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pop</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;skill&quot;</span>:-1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#从后面删除</span>
db.user.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xcc&quot;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pop</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;skill&quot;</span>:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#从前面删除</span>
db.user.updateOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xcc&quot;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$pull</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;skill&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#删除指定元素</span>
</code></pre></div><p>💡 一个常见的错误是查询条件匹配到了多个文档，然后更新时由第二个参数产生了重复的 &quot;_id&quot; 值。数据库会抛出错误，任何文档都不会被更新。避免这种情况的最好方法是确保更新始终指定一个唯一的文档，例如使用 &quot;_id&quot; 这样的键来匹配更新。</p> <br> <h2 id="_4-查询数据"><a href="#_4-查询数据" class="header-anchor">#</a> 4.查询数据</h2> <br> <h3 id="_4-1-基本查询"><a href="#_4-1-基本查询" class="header-anchor">#</a> 4.1 基本查询</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查询所有记录, 并格式化输出</span>
db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.pretty<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 随机返回一个记录</span>
db.inventory.findOne<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><br> <h3 id="_4-2-简单条件查询"><a href="#_4-2-简单条件查询" class="header-anchor">#</a> 4.2 简单条件查询</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>  <span class="token comment"># 单字段查询</span>

db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span>, <span class="token string">&quot;qty&quot;</span><span class="token builtin class-name">:</span> <span class="token number">50</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>  <span class="token comment"># 多字段复合查询</span>
</code></pre></div><br> <h3 id="_4-3-使用查询操作符"><a href="#_4-3-使用查询操作符" class="header-anchor">#</a> 4.3 使用查询操作符</h3> <blockquote><p>完整运算符见： <a href="https://docs.mongodb.com/manual/reference/operator/query/#comparison" target="_blank" rel="noopener noreferrer">运算符手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p><strong>比较运算符</strong></p> <table><thead><tr><th>名字</th> <th>描述</th></tr></thead> <tbody><tr><td>$eq</td> <td>匹配等于指定值的值。</td></tr> <tr><td>$gt</td> <td>匹配大于指定值的值。</td></tr> <tr><td>$gte</td> <td>匹配大于或等于指定值的值。</td></tr> <tr><td>$in</td> <td>匹配数组中指定的任何值。</td></tr> <tr><td>$lt</td> <td>匹配小于指定值的值。</td></tr> <tr><td>$lte</td> <td>匹配小于或等于指定值的值。</td></tr> <tr><td>$ne</td> <td>匹配所有不等于指定值的值。</td></tr> <tr><td>$nin</td> <td>与数组中指定的值均不匹配。</td></tr></tbody></table> <p><strong>逻辑运算符</strong></p> <table><thead><tr><th>名字</th> <th>描述</th></tr></thead> <tbody><tr><td>$and</td> <td>使用逻辑连接查询子句将返回与两个子句的条件匹配的所有文档。</td></tr> <tr><td>$not</td> <td>反转查询表达式的效果，并返回与查询表达式不匹配的文档。</td></tr> <tr><td>$nor</td> <td>使用逻辑连接查询子句将返回所有与这两个子句都不匹配的文档。</td></tr> <tr><td>$or</td> <td>使用逻辑连接查询子句将返回与任一子句的条件匹配的所有文档。</td></tr></tbody></table> <p><strong>元素</strong></p> <table><thead><tr><th>名字</th> <th>描述</th></tr></thead> <tbody><tr><td>$exists</td> <td>匹配具有指定字段的文档。</td></tr> <tr><td>$type</td> <td>如果字段属于指定类型，则选择文档。</td></tr></tbody></table> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># status的值为A或B</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$in</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;A&quot;</span>, <span class="token string">&quot;B&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用AND:（status为A）且（qty小于30）</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span>, <span class="token string">&quot;qty&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token comment"># 默认多条件就是AND</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token variable">$and</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">&quot;qty&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用OR:（status为A）或（qty小于30的值）</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token variable">$or</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">&quot;qty&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 复合AND和OR：（status=A）且（qty&lt;30 或 item字段以p开头）</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span>,
		<span class="token variable">$or</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">&quot;qty&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token string">&quot;item&quot;</span><span class="token builtin class-name">:</span> /^p/<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token comment"># 正则表达式</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><br> <h3 id="_4-4-查询嵌套文档"><a href="#_4-4-查询嵌套文档" class="header-anchor">#</a> 4.4 查询嵌套文档</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 完全匹配（包括字段顺序）</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> h: <span class="token number">14</span>, w: <span class="token number">21</span>, uom: <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 匹配部分字段</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;size.uom&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;in&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 配合操作符匹配</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token string">&quot;size.h&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">15</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><br> <h3 id="_4-5-查询数组"><a href="#_4-5-查询数组" class="header-anchor">#</a> 4.5 查询数组</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># --------------按元素内容匹配-------------#</span>
<span class="token comment"># 完全匹配</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span>, <span class="token string">&quot;blank&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 数组包含某个元素</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;red&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 数组有一个元素满足：大于15</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;dim_cm&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 数组有一个元素满足：大于15或小于20</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;dim_cm&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">15</span>, <span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 数组既包含red又包含blank</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$all</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;red&quot;</span>, <span class="token string">&quot;blank&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 查询仅匹配dim_cm 数组包含至少一个大于15且小于20的元素的那些文档：</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;dim_cm&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">22</span>, <span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># --------------按数组位置匹配-------------#</span>
<span class="token comment"># 数组第二个元素大于25</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;dim_cm.1&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># --------------按数组长度匹配-------------#</span>
<span class="token comment"># 数组长度为3</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;dim_cm&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$size</span><span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><br> <h3 id="_4-6-查询嵌套在数组中的文档"><a href="#_4-6-查询嵌套在数组中的文档" class="header-anchor">#</a> 4.6 查询嵌套在数组中的文档</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 完全匹配（数组中包含某一个记录）</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;instock&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> warehouse: <span class="token string">&quot;A&quot;</span>, qty: <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 匹配文档的元素</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">'instock.qty'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$lte</span><span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 添加数组索引条件</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">'instock.0.qty'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$lte</span><span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 指定多个条件</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;instock&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> qty: <span class="token number">5</span>, warehouse: <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;instock&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$elemMatch</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> qty: <span class="token punctuation">{</span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">10</span>, <span class="token variable">$lte</span><span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;instock.qty&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,  <span class="token variable">$lte</span><span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;instock.qty&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5</span>, <span class="token string">&quot;instock.warehouse&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token comment"># 不一定是同一个文档</span>
</code></pre></div><br> <h3 id="_4-7-查询空字段"><a href="#_4-7-查询空字段" class="header-anchor">#</a> 4.7 查询空字段</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 包含item其值为null 或不包含该item字段的字段的文档</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> item: null <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 包含item，且类型为null的文档（null的类型值为10）</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> item <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$type</span><span class="token builtin class-name">:</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 不包含item字段的文档</span>
db.inventory.find<span class="token punctuation">(</span> <span class="token punctuation">{</span> item <span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token variable">$exists</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><br> <h3 id="_4-8-使用投影-projection-过滤查询结果"><a href="#_4-8-使用投影-projection-过滤查询结果" class="header-anchor">#</a> 4.8 使用投影（projection）过滤查询结果</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 过滤部分字段</span>
db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>item :1, status: <span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>item :1, status: <span class="token number">1</span>, _id: <span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token comment"># 还可以过滤嵌入式文档</span>
db.inventory.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>subdoc.item<span class="token punctuation">}</span> <span class="token punctuation">)</span> 

db.inventory.findOne<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>item :1, status: <span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#_1-添加数据" title="1. 添加数据">1. 添加数据</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_2-删除数据" title="2. 删除数据">2. 删除数据</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_3-更新数据" title="3. 更新数据">3. 更新数据</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#_4-查询数据" title="4.查询数据">4.查询数据</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-1-基本查询" title="4.1 基本查询">4.1 基本查询</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-2-简单条件查询" title="4.2 简单条件查询">4.2 简单条件查询</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-3-使用查询操作符" title="4.3 使用查询操作符">4.3 使用查询操作符</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-4-查询嵌套文档" title="4.4 查询嵌套文档">4.4 查询嵌套文档</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-5-查询数组" title="4.5 查询数组">4.5 查询数组</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-6-查询嵌套在数组中的文档" title="4.6 查询嵌套在数组中的文档">4.6 查询嵌套在数组中的文档</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-7-查询空字段" title="4.7 查询空字段">4.7 查询空字段</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#_4-8-使用投影-projection-过滤查询结果" title="4.8 使用投影（projection）过滤查询结果">4.8 使用投影（projection）过滤查询结果</a></div></div></div></div> <footer class="footer" data-v-8eb634d6><div class="footer-left-wrap" data-v-8eb634d6><ul class="contact" data-v-8eb634d6><li class="contact-item" data-v-8eb634d6><a href="https://github.com/awesomexu" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-8eb634d6><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-8eb634d6><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-8eb634d6></path></svg>
          
        </a></li><li class="contact-item" data-v-8eb634d6><a href="mailto:xcc_mail@qq.com" class="nav-link external" data-v-8eb634d6><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-8eb634d6><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-8eb634d6></path><polyline points="22,6 12,13 2,6" data-v-8eb634d6></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-8eb634d6><ul class="copyright" data-v-8eb634d6><li class="copyright-item" data-v-8eb634d6><a href="https://policies.google.com/privacy?hl=en-US" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-8eb634d6>Privacy Policy</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2dcd9c50.js" defer></script><script src="/assets/js/6.b946c0f4.js" defer></script><script src="/assets/js/3.ef868f41.js" defer></script><script src="/assets/js/36.30f68b02.js" defer></script>
  </body>
</html>
