(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{336:function(t,n,s){"use strict";s.r(n);var e=s(5),a=Object(e.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("ä»€ä¹ˆæ˜¯ Nginxï¼Ÿ")])]),t._v(" "),s("p",[t._v("Nginx (engine x) æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ Web æœåŠ¡å™¨ ã€åå‘ä»£ç†æœåŠ¡å™¨åŠç”µå­é‚®ä»¶ï¼ˆIMAP/POP3ï¼‰ä»£ç†æœåŠ¡å™¨ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ")])]),t._v(" "),s("p",[t._v("åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å— internet ä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™ internet ä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚")]),t._v(" "),s("center",[s("img",{staticStyle:{zoom:"50%"},attrs:{src:"/2022-2/reverse-proxy.png"}})]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_1-nginx-å®‰è£…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-nginx-å®‰è£…"}},[t._v("#")]),t._v(" 1. Nginx å®‰è£…")]),t._v(" "),s("h3",{attrs:{id:"_1-1-ubuntu-apt-å®‰è£…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ubuntu-apt-å®‰è£…"}},[t._v("#")]),t._v(" 1.1 ubuntu-apt å®‰è£…")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx\n")])])]),s("p",[t._v("å¸¸ç”¨å‘½ä»¤ï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ nginx -s stop       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¿«é€Ÿå…³é—­Nginxï¼Œå¯èƒ½ä¸ä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œå¹¶è¿…é€Ÿç»ˆæ­¢webæœåŠ¡ã€‚")]),t._v("\n$ nginx -s quit       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¹³ç¨³å…³é—­Nginxï¼Œä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œæœ‰å®‰æ’çš„ç»“æŸwebæœåŠ¡ã€‚")]),t._v("\n$ nginx -s reload     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å› æ”¹å˜äº†Nginxç›¸å…³é…ç½®ï¼Œéœ€è¦é‡æ–°åŠ è½½é…ç½®è€Œé‡è½½ã€‚")]),t._v("\n$ nginx -s reopen     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ã€‚")]),t._v("\n$ nginx -c filename   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¸º Nginx æŒ‡å®šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¥ä»£æ›¿ç¼ºçœçš„ã€‚")]),t._v("\n$ nginx -t            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ä¸è¿è¡Œï¼Œä»…ä»…æµ‹è¯•é…ç½®æ–‡ä»¶ã€‚nginx å°†æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•çš„æ­£ç¡®æ€§ï¼Œå¹¶å°è¯•æ‰“å¼€é…ç½®æ–‡ä»¶ä¸­æ‰€å¼•ç”¨åˆ°çš„æ–‡ä»¶ã€‚")]),t._v("\n$ nginx -v            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ˜¾ç¤º nginx çš„ç‰ˆæœ¬ã€‚")]),t._v("\n$ nginx -V            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ˜¾ç¤º nginx çš„ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨ç‰ˆæœ¬å’Œé…ç½®å‚æ•°ã€‚")]),t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-docker-å®‰è£…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-docker-å®‰è£…"}},[t._v("#")]),t._v(" 1.2 Docker å®‰è£…")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d --name nginx --restart"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t-p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(":443 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t-v /docker/nginx/logs:/var/log/nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -v /docker/nginx/nginx.conf:/etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t-v /docker/nginx/conf.d:/etc/nginx/conf.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\t-v /docker/nginx/cert:/etc/nginx/cert "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n    -v /www:/www "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n\tnginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# æ­¤å¤„æ˜ å°„å‡ºæ¥çš„æ–‡ä»¶ä¸ºï¼šæ—¥å¿—ç›®å½•ã€ä¸»é…ç½®æ–‡ä»¶ã€å­é…ç½®ç›®å½•ã€sslè¯ä¹¦ç›®å½•ã€é™æ€æ–‡ä»¶ç›®å½•")]),t._v("\n")])])]),s("p",[t._v("ğŸ’¡ å¦‚æœä½¿ç”¨æ˜ å°„æ–‡ä»¶å¯åŠ¨ nginx dockerï¼Œè€Œæ˜ å°„çš„æ–‡ä»¶æ²¡æœ‰é…ç½®å¥½ï¼Œå¯èƒ½å¯åŠ¨ä¸æˆåŠŸã€‚")]),t._v(" "),s("p",[t._v("å¸¸ç”¨å‘½ä»¤ï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# è¿›å…¥å®¹å™¨æ‰§è¡Œnginxå‘½ä»¤")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it nginx -t\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it nginx -s reload\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å¸¸ç”¨dockerå‘½ä»¤")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" restart nginx "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# é‡å¯dockerè¿›ç¨‹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("br"),t._v(" "),s("h2",{attrs:{id:"_2-nginx-é…ç½®æ–‡ä»¶ç»“æ„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-nginx-é…ç½®æ–‡ä»¶ç»“æ„"}},[t._v("#")]),t._v(" 2. Nginx é…ç½®æ–‡ä»¶ç»“æ„")]),t._v(" "),s("center",[s("img",{staticStyle:{zoom:"40%"},attrs:{src:"/2022-2/nginxé…ç½®æ–‡ä»¶.png"}})]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("main")]),t._v("ï¼šå…¨å±€é…ç½®éƒ¨åˆ†ç”¨æ¥é…ç½®å¯¹æ•´ä¸ª server éƒ½æœ‰æ•ˆçš„å‚æ•°ã€‚ä¸»è¦ä¼šè®¾ç½®ä¸€äº›å½±å“ nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿è¡Œ Nginx æœåŠ¡å™¨çš„ç”¨æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸ç”Ÿæˆçš„ worker process æ•°ï¼Œè¿›ç¨‹ PID å­˜æ”¾è·¯å¾„ã€æ—¥å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥ åŠé…ç½®æ–‡ä»¶çš„å¼•å…¥ç­‰ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("events")]),t._v("ï¼ševents å—æ¶‰åŠçš„æŒ‡ä»¤ä¸»è¦å½±å“ Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œå¸¸ç”¨çš„è®¾ç½®åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š worker process ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ¯ä¸ª worker process å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("http")]),t._v("ï¼šhttp å…¨å±€å—é…ç½®çš„æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-TYPE å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ã€‚")])])]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"_3-å¸¸è§åº”ç”¨çš„é…ç½®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-å¸¸è§åº”ç”¨çš„é…ç½®"}},[t._v("#")]),t._v(" 3. å¸¸è§åº”ç”¨çš„é…ç½®")]),t._v(" "),s("blockquote",[s("p",[t._v("é…ç½®æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨/etc/nginx/conf.d/xxx.confï¼Œè¯¥ç›®å½•å·²ç»è¢« Nginx ä¸»é…ç½®æ–‡ä»¶ï¼ˆ/etc/nginx/nginx.confï¼‰çš„ http æ¨¡å—å¼•å…¥ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"_3-1-é…ç½®é™æ€èµ„æºæœåŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-é…ç½®é™æ€èµ„æºæœåŠ¡"}},[t._v("#")]),t._v(" 3.1 é…ç½®é™æ€èµ„æºæœåŠ¡")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server {\n\tlisten 80;\n\tserver_name localhost;\n\n\tlocation / {\n\t\talias /www/blog/;  # ä½¿ç”¨aliasï¼Œåˆ™/www/blogåçš„æ–‡ä»¶ä¸urlä¸€ä¸€å¯¹åº”\n\t    index index.html; # é»˜è®¤å°±æ˜¯index.html, å¯çœç•¥\n\t\t# autoindex on    # å¯ä»¥é€šè¿‡ç›®å½•æ–¹å¼è®¿é—®ï¼Œç±»ä¼¼æ–‡ä»¶æœåŠ¡å™¨\n\t}\n}\n")])])]),s("h3",{attrs:{id:"_3-2-é…ç½®åå‘ä»£ç†æœåŠ¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-é…ç½®åå‘ä»£ç†æœåŠ¡"}},[t._v("#")]),t._v(" 3.2 é…ç½®åå‘ä»£ç†æœåŠ¡")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("upstream local {\n    server localhost:8080;\n}\n\nserver {\n    listen 80;\n    server_name www.xucongcong.top; # åŒ¹é…åŸŸåï¼ˆå¤šä¸ªåå‘ä»£ç†æœåŠ¡å¯ä»¥éƒ½ä½¿ç”¨80ç«¯å£ï¼Œä½†ä½¿ç”¨åŸŸååŒºåˆ†ä»£ç†è§„åˆ™ï¼‰\n\n    location / {\n\t\tproxy_set_header Host $host;\n\t\tproxy_set_header X-Real-IP $remote_addr;\n\t\tproxy_set_header X_Forward-For $proxy_add_x_forwarded_for;\n        proxy_pass http://local;\n    }\n}\n\n")])])]),s("h3",{attrs:{id:"_3-3-é…ç½®è´Ÿè½½å‡è¡¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-é…ç½®è´Ÿè½½å‡è¡¡"}},[t._v("#")]),t._v(" 3.3 é…ç½®è´Ÿè½½å‡è¡¡")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("upstream local {\n    server localhost:8080; # æƒé‡weighté»˜è®¤ç›¸åŒ, è¯¦ç»†çš„æƒé‡é…ç½®è§æ–‡æ¡£\n    server localhost:8081;\n}\n\nserver {\n    listen 80;\n    server_name www.xucongcong.top;\n\n    location / {\n        proxy_pass http://local;\n    }\n}\n\n")])])]),s("h3",{attrs:{id:"_3-4-é…ç½®-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-é…ç½®-https"}},[t._v("#")]),t._v(" 3.4 é…ç½® https")]),t._v(" "),s("blockquote",[s("p",[t._v("å…ˆä¸‹è½½è¯ä¹¦åˆ°æŒ‡å®šç›®å½•ï¼Œè¿™é‡Œæ”¾åœ¨/etc/nginx/cert ç›®å½•ä¸‹")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# è¿™ä¸ªé…ç½®èƒ½å°†80ç«¯å£çš„httpè¯·æ±‚é‡å®šå‘åˆ°443çš„httpsè¯·æ±‚\nserver {\n\tlisten 80;\n\tserver_name www.xucongcong.top;\n\trewrite ^(.*)$ https://$host$1;\n}\n\nserver {\n    listen 443 ssl;\n    server_name www.xucongcong.com;\n\n    ssl_certificate cert/www.xucongcong.com.pem;\n    ssl_certificate_key cert/www.xucongcong.com.key;\n    ssl_session_timeout 5m;\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3; #è¡¨ç¤ºä½¿ç”¨çš„TLSåè®®çš„ç±»å‹ã€‚\n    ssl_prefer_server_ciphers on;\n\n\tlocation / {\n\t\talias /www/blog/;\n\t}\n}\n\n")])])]),s("h2",{attrs:{id:"å‚è€ƒæ–‡æ¡£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒæ–‡æ¡£"}},[t._v("#")]),t._v(" å‚è€ƒæ–‡æ¡£")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://dunwu.github.io/nginx-tutorial/#/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx æç®€æ•™ç¨‹"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"http://nginx.org/en/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx å®˜æ–¹æ–‡æ¡£"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://juejin.cn/post/6844903944267759624",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx è¿™ä¸€ç¯‡å°±å¤Ÿäº†"),s("OutboundLink")],1)])])],1)}),[],!1,null,null,null);n.default=a.exports}}]);