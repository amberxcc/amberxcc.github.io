(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{343:function(t,s,a){"use strict";a.r(s);var r=a(5),n=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-模型设计基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-模型设计基础"}},[t._v("#")]),t._v(" 1. 模型设计基础")]),t._v(" "),a("blockquote",[a("p",[t._v("数据模型是一组由符号、文本组成的集合，用以准确表达信息，达到有效交流、沟通的目的。— "),a("em",[t._v("霍夫曼. 数据建模经典教程")])])]),t._v(" "),a("h3",{attrs:{id:"_1-1-数据模型设计的基本元素"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-数据模型设计的基本元素"}},[t._v("#")]),t._v(" 1.1 数据模型设计的基本元素")]),t._v(" "),a("hr"),t._v(" "),a("ul",[a("li",[t._v("实体：描述业务的主要数据集合（如用户表、订单表）")]),t._v(" "),a("li",[t._v("属性：描述实体内的单个信息（如用户表中的username字段）")]),t._v(" "),a("li",[t._v("关系：描述实体与实体之间的数据规则：1-N，N-1，N-N")])]),t._v(" "),a("h3",{attrs:{id:"_1-2-传统关系模型设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-传统关系模型设计"}},[t._v("#")]),t._v(" 1.2 传统关系模型设计")]),t._v(" "),a("hr"),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("概念模型 CDM")]),t._v(" "),a("th",[t._v("逻辑模型 LDM")]),t._v(" "),a("th",[t._v("物理模型 PDM")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("目的")]),t._v(" "),a("td",[t._v("描述业务系统要管理的对象")]),t._v(" "),a("td",[t._v("基于概念模型，详细累出所有实体、属性、关系")]),t._v(" "),a("td",[t._v("根据逻辑模型，结合数据库和物理结构，设计具体的表结构、字段、主外键")])]),t._v(" "),a("tr",[a("td",[t._v("特点")]),t._v(" "),a("td",[t._v("用概念名词描述业务实体（如联系人）")]),t._v(" "),a("td",[t._v("基于业务的描述与数据库无关")]),t._v(" "),a("td",[t._v("与具体的数据库相关的实现细节")])]),t._v(" "),a("tr",[a("td",[t._v("使用者")]),t._v(" "),a("td",[t._v("用户、需求分析师")]),t._v(" "),a("td",[t._v("需求分析师、开发者、架构师")]),t._v(" "),a("td",[t._v("开发者、DBA")])])])]),t._v(" "),a("p",[t._v("示例：联系人管理的模型设计")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("概念模型：")])])]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign0.png"}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("逻辑模型：")])])]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign1.png"}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("物理模型：")])])]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign2.png"}})]),t._v(" "),a("h2",{attrs:{id:"_2-mongodb模型设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-mongodb模型设计"}},[t._v("#")]),t._v(" 2. MongoDB模型设计")]),t._v(" "),a("h3",{attrs:{id:"_2-1-文档模型设计的三个误区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-文档模型设计的三个误区"}},[t._v("#")]),t._v(" 2.1 文档模型设计的三个误区")]),t._v(" "),a("hr"),t._v(" "),a("ul",[a("li",[t._v("不需要文档模型设计？")]),t._v(" "),a("li",[t._v("MongoDB应该用一个超级大的文档来组织所有数据？")]),t._v(" "),a("li",[t._v("MongoDB不支持关联或事物？")])]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign3.png"}})]),t._v(" "),a("h3",{attrs:{id:"_2-2-mongodb-无-schema-的来源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-mongodb-无-schema-的来源"}},[t._v("#")]),t._v(" 2.2 MongoDB 无 Schema 的来源")]),t._v(" "),a("hr"),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign4.png"}})]),t._v(" "),a("p",[t._v("严格来说，MongoDB同样需要概念、逻辑建模，只是文档模型设计的物理层结构可以和逻辑层类似，部分情况甚至可以直接使用逻辑层从而"),a("strong",[t._v("省略物理建模过程")]),t._v("，这也是 MongoDB 无 schema 的说法来源。")]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign5.png"}})]),t._v(" "),a("h3",{attrs:{id:"_2-3-文档模型设计的原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-文档模型设计的原则"}},[t._v("#")]),t._v(" 2.3 文档模型设计的原则")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("文档模型没有第三范式的约束，两个主要的指导原则是"),a("strong",[t._v("性能")]),t._v("和"),a("strong",[t._v("易用性")]),t._v("。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("关系模型")]),t._v(" "),a("th",[t._v("文档模型")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("模型设计层次")]),t._v(" "),a("td",[t._v("概念模型、逻辑模型、物理模型")]),t._v(" "),a("td",[t._v("概念模型、逻辑模型")])]),t._v(" "),a("tr",[a("td",[t._v("模型实体")]),t._v(" "),a("td",[t._v("表")]),t._v(" "),a("td",[t._v("集合")])]),t._v(" "),a("tr",[a("td",[t._v("模型属性")]),t._v(" "),a("td",[t._v("列")]),t._v(" "),a("td",[t._v("字段")])]),t._v(" "),a("tr",[a("td",[t._v("模型关系")]),t._v(" "),a("td",[t._v("关联关系、主外键")]),t._v(" "),a("td",[t._v("内嵌数组、引用字段")])])])]),t._v(" "),a("h2",{attrs:{id:"_3-文档模型设计-三部曲"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-文档模型设计-三部曲"}},[t._v("#")]),t._v(" 3. 文档模型设计（三部曲）")]),t._v(" "),a("br"),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"30%"},attrs:{src:"/2023-3/mongoDesign6.png"}})]),t._v(" "),a("br"),t._v(" "),a("h3",{attrs:{id:"_3-1-基础设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-基础设计"}},[t._v("#")]),t._v(" 3.1 基础设计")]),t._v(" "),a("hr"),t._v(" "),a("ol",[a("li",[t._v("根据概念模型或业务需求推导出逻辑模型 - 找到对象")]),t._v(" "),a("li",[t._v("列出实体之间的关系 - 明确关系")]),t._v(" "),a("li",[t._v("套用逻辑设计原则来决定内嵌方式 - 进行建模")]),t._v(" "),a("li",[t._v("完成基础模型构建")])]),t._v(" "),a("br"),t._v(" "),a("p",[a("strong",[t._v("示例：联系人管理")])]),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"50%"},attrs:{src:"/2023-3/mongoDesign7.png"}})]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("1-1")]),t._v(" 关系建模：以内嵌为主，没有冗余（例外情况：大小超过16M）")]),t._v(" "),a("li",[a("strong",[t._v("1-N")]),t._v(" 关系建模：以内嵌为主，用数组表示一对多，没有冗余，例外情况：嵌入后文档大小超过16M、数组长度太大、数组长度不确定。")]),t._v(" "),a("li",[a("strong",[t._v("N-N")]),t._v(" 关系建模：一般通过内嵌数组表示一对多、通过冗余实现N-N，不使用映射表。例外情况：嵌入后文档大小超过16M、数组长度太大、数组长度不确定。")])]),t._v(" "),a("h3",{attrs:{id:"_3-2-工况细化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-工况细化"}},[t._v("#")]),t._v(" 3.2 工况细化")]),t._v(" "),a("hr"),t._v(" "),a("center",[a("img",{staticStyle:{zoom:"40%"},attrs:{src:"/2023-3/mongoDesign8.png"}})]),t._v(" "),a("p",[t._v("基于内嵌的关系模型可以根据实际情况换成引用方法：")]),t._v(" "),a("ul",[a("li",[t._v("内嵌数组过长、长度不确定、频繁修改")]),t._v(" "),a("li",[t._v("单个字段很大或不常用")])]),t._v(" "),a("p",[t._v("💡 mongodb中的 $lookup 相当于关系型数据库中的LEFT JOIN，且没有数据库级别的限制，全靠业务逻辑维持数据一致性。且lookup的关联目标不能是分布式架构中的分片表。")]),t._v(" "),a("h3",{attrs:{id:"_3-3-参考设计模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-参考设计模式"}},[t._v("#")]),t._v(" 3.3 参考设计模式")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("文档设计相当灵活，一个好的设计可以显著提升数据读写效率、降低存储资源需求。")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("例如IOT场景下对时序数据的"),a("strong",[t._v("分桶设计")]),t._v("：假设正常情况下飞机每分钟产生一条飞行数据，格式：")]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"icao"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CA2790"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"callsign"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CA2790"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"ts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1677663118774")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"event"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"a"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12121")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"b"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5534")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"c"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("110")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("333")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("br"),t._v(" "),a("p",[t._v("由于每条数据的有用信息是event字段，其他信息都是重复信息，如果将一小时的数据放在一条记录中，就可以"),a("strong",[t._v("节省大量的重复信息存储和索引存储")]),t._v("，"),a("strong",[t._v("同时查询效率更高")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-jsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  重复字段")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"icao"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CA2790"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  重复字段")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"callsign"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CA2790"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  重复字段")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"ts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1677663118774")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  重复字段")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"event"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12121")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"b"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5534")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"c"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("110")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("333")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12122")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"b"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5535")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"c"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("111")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("334")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("br"),t._v(" "),a("p",[t._v("其他设计模式：")]),t._v(" "),a("ul",[a("li",[t._v("记录文档版本：通过一个额外字段管理不同版本的文档")]),t._v(" "),a("li",[t._v("近似计算：对于写入频繁但准确性要求不高的场景（如准确性要求不高的排名）")]),t._v(" "),a("li",[t._v("预聚合：需要统计数量的字段使用单独维护，若每次都扫描动态查询，影响性能")])])],1)}),[],!1,null,null,null);s.default=n.exports}}]);