<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>amberx | amberx</title>
    <meta name="description" content="A VitePress Blog ">
    <link rel="preload stylesheet" href="/assets/style.9dc6b7d9.css" as="style">
    <script type="module" src="/assets/app.9aecc9ac.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/assets/chunks/framework.8ca2618e.js">
  <link rel="modulepreload" href="/assets/chunks/theme.8b705d23.js">
  <link rel="modulepreload" href="/assets/blog_index.md.1346bf23.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b2cf3e0b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8616af1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8616af1> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b2cf3e0b data-v-7e5bc4a5><div class="VPNavBar" data-v-7e5bc4a5 data-v-94c81dcc><div class="container" data-v-94c81dcc><div class="title" data-v-94c81dcc><div class="VPNavBarTitle" data-v-94c81dcc data-v-f4ef19a3><a class="title" href="/" data-v-f4ef19a3><!--[--><!--]--><!----><!--[-->amberx<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-94c81dcc><div class="curtain" data-v-94c81dcc></div><div class="content-body" data-v-94c81dcc><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-94c81dcc><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-94c81dcc data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Blog<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog/tags.html" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->Tags<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about.html" tabindex="0" data-v-7f418b0f data-v-37adc828 data-v-8f4dc553><!--[-->About<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-94c81dcc data-v-f6a63727><label title="toggle dark mode" data-v-f6a63727 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-94c81dcc data-v-0394ad82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/amberxcc" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-c530cc0a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-94c81dcc data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><label title="toggle dark mode" data-v-40855f84 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/amberxcc" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-c530cc0a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-94c81dcc data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-b2cf3e0b data-v-59bd7401><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-59bd7401 data-v-079b16a8><button data-v-079b16a8>Return to top</button><!----></div></div><!----><div class="VPContent is-home" id="VPContent" data-v-b2cf3e0b data-v-a494bd1d><div class="VPHome" data-v-a494bd1d data-v-d82743a8><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--><!----><!--[--><!--]--><div style="position:relative;" data-v-d82743a8><div><div class="mx-auto max-w-screen-xl lg:px-6 lg:py-16"><div class="mx-auto mb-8 max-w-screen-sm text-center lg:mb-16"><h2 class="mb-4 text-3xl font-extrabold tracking-tight text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)] lg:text-4xl"></h2><p class="font-light text-[color:var(--vp-c-text-light-1)] dark:text-[color:var(--vp-c-text-dark-1)] sm:text-xl"></p></div><div class="grid gap-6 p-2 lg:grid-cols-2"><!--[--><div><article class="rounded-lg border border-[color:var(--vp-c-brand-light)] p-6 shadow-md dark:border-[color:var(--vp-c-brand-dark)]"><div class="mb-5 flex items-center justify-between text-gray-500"><span class="bg-primary-100 inline-flex items-center rounded text-sm font-medium text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)]"><div data-v-780fdfbe><div class="i-[heroicons-outline/book-open] mr-2" data-v-780fdfbe></div><span data-v-780fdfbe>Article</span></div></span></div><h2 class="mb-2 text-2xl font-bold tracking-tight text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)]"><a href="/blog/posts/JavaScript-fp.html">JavaScript 函数式编程</a></h2><div class="mb-5 font-light"><p>函数式编程思想是一种对运算过程的抽象，这里的函数是指数学意义上映射关系（如<em>y=sin(x)</em>），也称为纯函数，而编程语言定义的函数除了运算，往往带有副作用，如 IO 操作、影响外部变量等。</p>
<nav class="table-of-contents"><ul><li><a href="#_1-函数式编程基础">1. 函数式编程基础</a><ul><li><a href="#_1-1-函数是一等公民">1.1 函数是一等公民</a></li><li><a href="#_1-2-高阶函数">1.2 高阶函数</a></li></ul></li></ul></nav>
<h2 id="_1-函数式编程基础" tabindex="-1">1. 函数式编程基础 <a class="header-anchor" href="#_1-函数式编程基础" aria-label="Permalink to &quot;1. 函数式编程基础&quot;">&ZeroWidthSpace;</a></h2>
<h3 id="_1-1-函数是一等公民" tabindex="-1">1.1 函数是一等公民 <a class="header-anchor" href="#_1-1-函数是一等公民" aria-label="Permalink to &quot;1.1 函数是一等公民&quot;">&ZeroWidthSpace;</a></h3>
<p>函数只是一个特殊的对象，可以用变量表示（函数是一等公民）</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">add</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">x</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">y</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #BABED8">x</span><span style="color: #F07178"> </span><span style="color: #89DDFF">+</span><span style="color: #F07178"> </span><span style="color: #BABED8">y</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C792EA">const</span><span style="color: #BABED8"> sum </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> add</span></span>
<span class="line"><span style="color: #82AAFF">sum</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">2</span><span style="color: #BABED8">) </span><span style="color: #676E95; font-style: italic">// 3</span></span></code></pre>
</div><h3 id="_1-2-高阶函数" tabindex="-1">1.2 高阶函数 <a class="header-anchor" href="#_1-2-高阶函数" aria-label="Permalink to &quot;1.2 高阶函数&quot;">&ZeroWidthSpace;</a></h3>
<ul>
<li>函数可以作为参数</li>
<li>函数可以作为返回值</li>
</ul>
<p>函数作为参数，模拟实现 forEach 函数：</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">myForEach</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">array</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">f</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">for</span><span style="color: #F07178"> (</span><span style="color: #C792EA">let</span><span style="color: #F07178"> </span><span style="color: #BABED8">i</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">;</span><span style="color: #F07178"> </span><span style="color: #BABED8">i</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&lt;</span><span style="color: #F07178"> </span><span style="color: #BABED8">array</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">length</span><span style="color: #89DDFF">;</span><span style="color: #F07178"> </span><span style="color: #BABED8">i</span><span style="color: #89DDFF">++</span><span style="color: #F07178">) </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">f</span><span style="color: #F07178">(</span><span style="color: #BABED8">array</span><span style="color: #F07178">[</span><span style="color: #BABED8">i</span><span style="color: #F07178">])</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #82AAFF">myForEach</span><span style="color: #BABED8">([</span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">2</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">3</span><span style="color: #BABED8">]</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">itemÏ</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">item</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span></code></pre>
</div><p>函数作为返回值，封装一个 once 函数，生成一个只能执行一次的函数：</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">once</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">fn</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #C792EA">let</span><span style="color: #F07178"> </span><span style="color: #BABED8">done</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #FF9CAC">false</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #89DDFF">(...</span><span style="color: #BABED8; font-style: italic">args</span><span style="color: #89DDFF">)</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF; font-style: italic">if</span><span style="color: #F07178"> (</span><span style="color: #89DDFF">!</span><span style="color: #BABED8">done</span><span style="color: #F07178">) </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #BABED8">done</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #FF9CAC">true</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #82AAFF">fn</span><span style="color: #F07178">(</span><span style="color: #89DDFF">...</span><span style="color: #BABED8">args</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C792EA">const</span><span style="color: #BABED8"> pay </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">once</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">money</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #89DDFF">`</span><span style="color: #C3E88D">消费了</span><span style="color: #89DDFF">${</span><span style="color: #BABED8">money</span><span style="color: #89DDFF">}</span><span style="color: #C3E88D">元</span><span style="color: #89DDFF">`</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #82AAFF">pay</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">5</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #82AAFF">pay</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">5</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #82AAFF">pay</span><span style="color: #BABED8">(</span><span style="color: #F78C6C">5</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #676E95; font-style: italic">//</span></span></code></pre>
</div></div><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><img class="h-7 w-7 rounded-full" src="/avatar.jpg" alt="xcc"><a href="/blog/authors/ai-writer.html" class="inline-flex items-center font-medium hover:text-[color:var(--vp-c-brand-dark)]"><span class="font-medium dark:text-white">xcc</span></a></div><a href="/blog/posts/JavaScript-fp.html" class="inline-flex items-center font-medium hover:text-[color:var(--vp-c-brand-dark)]"> Read more <div class="i-[bx/right-arrow-alt] ml-2"></div></a></div></article></div><div><article class="rounded-lg border border-[color:var(--vp-c-brand-light)] p-6 shadow-md dark:border-[color:var(--vp-c-brand-dark)]"><div class="mb-5 flex items-center justify-between text-gray-500"><span class="bg-primary-100 inline-flex items-center rounded text-sm font-medium text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)]"><div data-v-780fdfbe><div class="i-[heroicons-outline/book-open] mr-2" data-v-780fdfbe></div><span data-v-780fdfbe>Article</span></div></span></div><h2 class="mb-2 text-2xl font-bold tracking-tight text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)]"><a href="/blog/posts/JavaScript-asyc.html">JavaScript 异步编程</a></h2><div class="mb-5 font-light"><p>JavaScript的一个核心特性是单线程执行，这里的单线程是指代码的执行是单线程的（宿主环境的API可以多线程），其最初的目的是为了避免多线程的DOM操作可能带来的错乱。优点是更安全简单，缺点是当遇到一个耗时任务时，后面的任务会被阻塞，从而拖延整个程序的执行。</p>
<p>为了解决耗时任务阻塞线程的问题，JavaScript将任务的执行模式分为了同步模式和异步模式，运行环境也提供了以同步或者异步模式运行的API。</p>
<ul>
<li><strong>同步模式</strong>: 任务排队执行，执行过程容易理解。</li>
<li><strong>异步模式</strong>: 对于耗时操作，开启过后就立即往后执行下一个任务，异步后续的逻辑一般通过回调函数的方式定义，在耗时任务执行过后就会自动执行传入的回调函数。</li>
</ul>
<img src="/2023/promise0.png" width="80%" style="margin: 1% 10% 1% 10%;"/>
<p>JavaScript引擎会先执行完调用栈中的任务，然后通过事件循环从“消息队列”中再取一个出来执行，在此过程中，可以随时再往消息队列中添加任务。也正是因为大量的异步模式的API导致代码一些复杂的异步逻辑不易阅读。</p>
<nav class="table-of-contents"><ul><li><a href="#_1-回调函数">1. 回调函数</a></li><li><a href="#_2-promise">2. Promise</a><ul><li><a href="#_2-1-promise-的基本用法">2.1 Promise 的基本用法</a></li><li><a href="#_2-2-promise-封装一个异步任务函数">2.2 Promise 封装一个异步任务函数</a></li><li><a href="#_2-3-promise-的链式调用">2.3 Promise 的链式调用</a></li><li><a href="#_2-4-promise-的异常处理">2.4 Promise 的异常处理</a></li><li><a href="#_2-5-promise-的静态方法">2.5 Promise 的静态方法</a></li><li><a href="#_2-6-promise-并行执行">2.6 Promise 并行执行</a></li><li><a href="#_2-7-promise-的执行时序-宏任务-微任务">2.7 Promise 的执行时序（宏任务&amp;微任务）</a></li></ul></li></ul></nav>
<h2 id="_1-回调函数" tabindex="-1">1. 回调函数 <a class="header-anchor" href="#_1-回调函数" aria-label="Permalink to &quot;1. 回调函数&quot;">&ZeroWidthSpace;</a></h2>
<p>回调函数是所有异步编程方案的根基，回调函数由调用者定义，交给执行者执行，具体用法就是把函数作为参数传递罢了。</p>
<p>除了传递回调函数参数以外，还有几种常见的实现异步的方式如事件机制、发布订阅，可以理解为回调函数的变体。</p>
<p>当使用传统回调方式去完成复杂的异步流程时，会无法避免大量的回调函数嵌套，造成回调地狱问题</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #82AAFF">setTimeout</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">1.执行任务1 -&gt; 三秒后执行任务2</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">setTimeout</span><span style="color: #F07178">(</span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #89DDFF">()</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">2.执行任务2 -&gt; 2秒后执行任务1</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">setTimeout</span><span style="color: #F07178">(</span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #89DDFF">()</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">3.执行任务3 -&gt; 1秒后执行完毕</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">      </span><span style="color: #676E95; font-style: italic">// 回调地狱...</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">},</span><span style="color: #F07178"> </span><span style="color: #F78C6C">1000</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">},</span><span style="color: #F07178"> </span><span style="color: #F78C6C">2000</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">},</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">3000</span><span style="color: #BABED8">)</span></span></code></pre>
</div><h2 id="_2-promise" tabindex="-1">2. Promise <a class="header-anchor" href="#_2-promise" aria-label="Permalink to &quot;2. Promise&quot;">&ZeroWidthSpace;</a></h2>
<p><strong>为了避免回调地狱问题</strong>，CommonJS社区提出了Promise规范，并在ES2015中被标准化。Promise实际上就是一个对象，用来表示一个异步任务执行过后究竟是成功还是失败，无论成功或失败只需要执行相应的回调函数即可。</p>
<img src="/2023/promise1.png" width="80%" style="margin: 1% 10% 1% 10%;"/>
<h3 id="_2-1-promise-的基本用法" tabindex="-1">2.1 Promise 的基本用法 <a class="header-anchor" href="#_2-1-promise-的基本用法" aria-label="Permalink to &quot;2.1 Promise 的基本用法&quot;">&ZeroWidthSpace;</a></h3>
<ol>
<li>构建Promise实例时传入一个函数，函数的参数为两个处理函数，在Promise里编写承诺的逻辑，即什么情况下成功，什么情况下失败，并在成功或失败时改变状态，执行提前注册的处理函数</li>
<li>使用then方法分别注册promise实例的onFulfilledon和onRejected回调函数</li>
<li>注意注册的函数不会立即执行，而是等待同步代码执行完才会执行（如下例）</li>
</ol>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #C792EA">let</span><span style="color: #BABED8"> a </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">1</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> b </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">2</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C792EA">const</span><span style="color: #BABED8"> promise </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">new</span><span style="color: #BABED8"> </span><span style="color: #FFCB6B">Promise</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">res</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">rej</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">if</span><span style="color: #F07178"> (</span><span style="color: #BABED8">a</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&gt;</span><span style="color: #F07178"> </span><span style="color: #BABED8">b</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">res</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">success</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">) </span><span style="color: #676E95; font-style: italic">// 成功时调用res函数</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">else</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #82AAFF">rej</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">fail</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)    </span><span style="color: #676E95; font-style: italic">// 失败时调用rej函数</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BABED8">promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">sucStr</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">sucStr</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">},</span><span style="color: #BABED8"> </span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">failStr</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">failStr</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">第一个同步任务执行才会执行提前注册的异步处理函数</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span></code></pre>
</div><h3 id="_2-2-promise-封装一个异步任务函数" tabindex="-1">2.2 Promise 封装一个异步任务函数 <a class="header-anchor" href="#_2-2-promise-封装一个异步任务函数" aria-label="Permalink to &quot;2.2 Promise 封装一个异步任务函数&quot;">&ZeroWidthSpace;</a></h3>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #676E95; font-style: italic">// 使用promise封装一个ajax请求</span></span>
<span class="line"><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">ajax</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">url</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #89DDFF">new</span><span style="color: #F07178"> </span><span style="color: #FFCB6B">Promise</span><span style="color: #F07178">(</span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">resolve</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #BABED8; font-style: italic">reject</span><span style="color: #89DDFF">)</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #C792EA">let</span><span style="color: #F07178"> </span><span style="color: #BABED8">xhr</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">new</span><span style="color: #F07178"> </span><span style="color: #82AAFF">XMLHttpRequest</span><span style="color: #F07178">()</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">xhr</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">open</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">GET</span><span style="color: #89DDFF">&#39;</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #BABED8">url</span><span style="color: #F07178">)        </span><span style="color: #676E95; font-style: italic">// 指定请求方法和地址</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">xhr</span><span style="color: #89DDFF">.</span><span style="color: #BABED8">responseType</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">json</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">   </span><span style="color: #676E95; font-style: italic">// 指定相应类型为json</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">xhr</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">onload</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #C792EA">function</span><span style="color: #F07178"> </span><span style="color: #89DDFF">()</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178">  </span><span style="color: #676E95; font-style: italic">// 请求完成后执行onload函数</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF; font-style: italic">if</span><span style="color: #F07178"> (</span><span style="color: #89DDFF">this.</span><span style="color: #BABED8">status</span><span style="color: #F07178"> </span><span style="color: #89DDFF">===</span><span style="color: #F07178"> </span><span style="color: #F78C6C">200</span><span style="color: #F07178">) </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #82AAFF">resolve</span><span style="color: #F07178">(</span><span style="color: #89DDFF">this.</span><span style="color: #BABED8">response</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF; font-style: italic">else</span><span style="color: #F07178"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">        </span><span style="color: #82AAFF">reject</span><span style="color: #F07178">(</span><span style="color: #89DDFF">new</span><span style="color: #F07178"> </span><span style="color: #82AAFF">Error</span><span style="color: #F07178">(</span><span style="color: #89DDFF">this.</span><span style="color: #BABED8">status</span><span style="color: #F07178">))</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">      </span><span style="color: #BABED8">xhr</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">send</span><span style="color: #F07178">()</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF">}</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #82AAFF">ajax</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">/user.json</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">res</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">res</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">},</span><span style="color: #BABED8"> </span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">err</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">err</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span></code></pre>
</div><h3 id="_2-3-promise-的链式调用" tabindex="-1">2.3 Promise 的链式调用 <a class="header-anchor" href="#_2-3-promise-的链式调用" aria-label="Permalink to &quot;2.3 Promise 的链式调用&quot;">&ZeroWidthSpace;</a></h3>
<p>promise的本质也是使用回调函数，即通过then方法传递进去，而且promise将回调分成了两种即成功的回调和失败的回调。但是如果需要串联执行多个异步任务，还是会出现回调地狱的问题，这时候使用promise就没有任何意义了，还额外增加了复杂度。</p>
<p>所以嵌套使用promise是不可取的，正确的做法是使用promise方法链式调用的特点来尽量保证串联异步任务的 “扁平化”。</p>
<ul>
<li>promise的then方法会返回一个<strong>全新的</strong>promise对象，用于实现promise的链式调用</li>
<li>后面的then就是在为前面then返回的promise注册回调</li>
<li>前面then方法中调用函数的返回值会作为后面then方法回调的参数</li>
<li>若回调中返回的是一个promise对象，则后面then方法的回调会等待他的结束</li>
</ul>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #82AAFF">ajax</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">api/url1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">value</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">		</span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #82AAFF">ajax</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">api/url2</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">value</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">		</span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #82AAFF">ajax</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">api/url3</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">value</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">		</span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #82AAFF">ajax</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">api/url4</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">catch</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">error</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">		</span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">error</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span></code></pre>
</div><p>多次catch的链式调用（<em>for test</em>）：</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #C792EA">const</span><span style="color: #BABED8"> p </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">reject</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Error</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">fail1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BABED8">p</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">catch</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">err</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(err))</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">ok1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">ok2</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #C792EA">=&gt;</span><span style="color: #89DDFF">{</span><span style="color: #89DDFF; font-style: italic">throw</span><span style="color: #F07178"> </span><span style="color: #89DDFF">new</span><span style="color: #F07178"> </span><span style="color: #82AAFF">Error</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">fail2</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">)</span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">catch</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">err</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(err))</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">ok3</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">ok4</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span></code></pre>
</div><h3 id="_2-4-promise-的异常处理" tabindex="-1">2.4 Promise 的异常处理 <a class="header-anchor" href="#_2-4-promise-的异常处理" aria-label="Permalink to &quot;2.4 Promise 的异常处理&quot;">&ZeroWidthSpace;</a></h3>
<p>除了promise的执行逻辑执行了reject函数，在promise在执行的过程中出现错误或者主动抛出异常也会执行reject函数，所以then方法中注册的onrejected函数就是为promise的异常做处理，即promise失败或者出现异常都会被执行。其实onrejected函数的注册还有一个更常见的用法，即使用promise实例的catch方法注册onrejected回调</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #82AAFF">ajax</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">/user.json</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">onFulfilled</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">res</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">res</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">catch</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">onRejcted</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">error</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">error</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #676E95; font-style: italic">// 等同于</span></span>
<span class="line"><span style="color: #82AAFF">ajax</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">/user.json</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">onFulfilled</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">res</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">res</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">undefined,</span><span style="color: #BABED8"> </span><span style="color: #C792EA">function</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">onRejcted</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">error</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">error</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span></code></pre>
</div><p>用catch方法更常见，因为更适合链式调用。错误会随着promise链条传递，所以最后使用c<strong>atch方法更像是给整个promise链条注册的失败回调</strong></p>
<h3 id="_2-5-promise-的静态方法" tabindex="-1">2.5 Promise 的静态方法 <a class="header-anchor" href="#_2-5-promise-的静态方法" aria-label="Permalink to &quot;2.5 Promise 的静态方法&quot;">&ZeroWidthSpace;</a></h3>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">resolve</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">success</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)  </span><span style="color: #676E95; font-style: italic">// 直接返回一个成功的Promise对象</span></span>
<span class="line"><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">resolve</span><span style="color: #BABED8">(promise)    </span><span style="color: #676E95; font-style: italic">// 如果接收到一个promise对象则原样返回</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">reject</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">new</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">Error</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">rejected</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)) </span><span style="color: #676E95; font-style: italic">// 快速得到一个一定是失败的promise对象</span></span>
<span class="line"><span style="color: #BABED8">	</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">catch</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">error</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(err))</span></span></code></pre>
</div><h3 id="_2-6-promise-并行执行" tabindex="-1">2.6 Promise 并行执行 <a class="header-anchor" href="#_2-6-promise-并行执行" aria-label="Permalink to &quot;2.6 Promise 并行执行&quot;">&ZeroWidthSpace;</a></h3>
<p>前面都是多个promise串联执行异步任务，而当多个任务彼此没有依赖时可以并行执行来提高执行速度，Promise.all方法可以将多个promise合并为一个promise统一管理。Promise.all()接收一个数组，数组中每个元素都是一个promise对象，并返回一个全新的promise对象，当其内部所有的promise都完成后，这个新的promise对象才会完成，且其拿到的结果也是一个数组，数组包含每个异步任务执行的结果。其中任何一个promise失败，这个新的promise也就失败了。</p>
<p>示例：先拿到要访问的url列表，再并行访问</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #82AAFF">ajax</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">/urls.json</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">value</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #BABED8">urls</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #BABED8">Object</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">values</span><span style="color: #F07178">(</span><span style="color: #BABED8">value</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #C792EA">const</span><span style="color: #F07178"> </span><span style="color: #BABED8">tasks</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #BABED8">urls</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">map</span><span style="color: #F07178">(</span><span style="color: #BABED8; font-style: italic">map</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #82AAFF">ajax</span><span style="color: #F07178">(</span><span style="color: #BABED8">url</span><span style="color: #F07178">))</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #89DDFF; font-style: italic">return</span><span style="color: #F07178"> </span><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">all</span><span style="color: #F07178">(</span><span style="color: #BABED8">tasks</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">values</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">    </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">values</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span></code></pre>
</div><p>Promise.race()也可以将多个promise合并为一个promise对象，但Promise.all()等待所有任务结束才会结束，而Promise.race()只会等待第一个先结束的任务。</p>
<p>示例：一个请求promise+一个定时promise用于处理请求超时</p>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #C792EA">const</span><span style="color: #BABED8"> request </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #82AAFF">ajax</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">/urls.json</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #C792EA">const</span><span style="color: #BABED8"> timeout </span><span style="color: #89DDFF">=</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">new</span><span style="color: #BABED8"> </span><span style="color: #FFCB6B">Promise</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">(</span><span style="color: #BABED8; font-style: italic">resolve</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #BABED8; font-style: italic">reject</span><span style="color: #89DDFF">)</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span></span>
<span class="line"><span style="color: #F07178">  </span><span style="color: #82AAFF">setTimeout</span><span style="color: #F07178">(</span><span style="color: #89DDFF">()</span><span style="color: #F07178"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #F07178"> </span><span style="color: #82AAFF">reject</span><span style="color: #F07178">(</span><span style="color: #89DDFF">new</span><span style="color: #F07178"> </span><span style="color: #82AAFF">Error</span><span style="color: #F07178">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">timeout</span><span style="color: #89DDFF">&#39;</span><span style="color: #F07178">))</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #F78C6C">500</span><span style="color: #F07178">)</span></span>
<span class="line"><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">race</span><span style="color: #BABED8">([</span></span>
<span class="line"><span style="color: #BABED8">  request</span><span style="color: #89DDFF">,</span></span>
<span class="line"><span style="color: #BABED8">  timeout</span></span>
<span class="line"><span style="color: #BABED8">])</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">value</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">value</span><span style="color: #F07178">) </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">catch</span><span style="color: #BABED8">(</span><span style="color: #BABED8; font-style: italic">error</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> </span><span style="color: #89DDFF">{</span><span style="color: #F07178"> </span><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #F07178">(</span><span style="color: #BABED8">error</span><span style="color: #F07178">) </span><span style="color: #89DDFF">}</span><span style="color: #BABED8">)</span></span></code></pre>
</div><h3 id="_2-7-promise-的执行时序-宏任务-微任务" tabindex="-1">2.7 Promise 的执行时序（宏任务&amp;微任务） <a class="header-anchor" href="#_2-7-promise-的执行时序-宏任务-微任务" aria-label="Permalink to &quot;2.7 Promise 的执行时序（宏任务&amp;微任务）&quot;">&ZeroWidthSpace;</a></h3>
<p>即使Promise没有任何的异步操作，它的回调函数仍然不会立即执行而是进入回调队列中排队，即等待所有同步代码执行完后才会执行。</p>
<p>但在回调队列中排队等待的任务并不是平等的。回调队列中的任务称为宏任务，宏任务的执行过程中可以临时加上一些额外需求，这些临时需求可以作为新的宏任务进到队列排队（如下setTimeout回调），也可以作为当前任务的微任务，直接在本轮调用的末尾立即执行（如下Promise回调），微任务的概念是后来才提到JS中的，目的是为了提高整体响应能力。目前绝大多数异步调用的API都是作为宏任务执行，而作为微任务的有Promise &amp; MutationObserver &amp; Node中的process.nextTick</p>
<aside>
💡 在浏览器环境中有两个任务队列：宏任务和微任务队列，微任务队列优先级更高，所以同步代码执行完或每次一个宏任务执行完后，都会优先清空微任务队列。
<p>在Node中，任务队列的优先级划分比浏览器更加细化。</p>
</aside>
<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre v-pre class="shiki material-theme-palenight" ><code><span class="line"><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">start</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #82AAFF">setTimeout</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">settimeout</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span><span style="color: #89DDFF">,</span><span style="color: #BABED8"> </span><span style="color: #F78C6C">0</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FFCB6B">Promise</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">resolve</span><span style="color: #BABED8">()</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">promise1</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">promise2</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"><span style="color: #BABED8">  </span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">then</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">()</span><span style="color: #BABED8"> </span><span style="color: #C792EA">=&gt;</span><span style="color: #BABED8"> console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">promise3</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color: #BABED8">console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">log</span><span style="color: #BABED8">(</span><span style="color: #89DDFF">&#39;</span><span style="color: #C3E88D">end</span><span style="color: #89DDFF">&#39;</span><span style="color: #BABED8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #676E95; font-style: italic">//</span></span></code></pre>
</div></div><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><img class="h-7 w-7 rounded-full" src="/avatar.jpg" alt="xcc"><a href="/blog/authors/ai-writer.html" class="inline-flex items-center font-medium hover:text-[color:var(--vp-c-brand-dark)]"><span class="font-medium dark:text-white">xcc</span></a></div><a href="/blog/posts/JavaScript-asyc.html" class="inline-flex items-center font-medium hover:text-[color:var(--vp-c-brand-dark)]"> Read more <div class="i-[bx/right-arrow-alt] ml-2"></div></a></div></article></div><div><article class="rounded-lg border border-[color:var(--vp-c-brand-light)] p-6 shadow-md dark:border-[color:var(--vp-c-brand-dark)]"><div class="mb-5 flex items-center justify-between text-gray-500"><span class="bg-primary-100 inline-flex items-center rounded text-sm font-medium text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)]"><div data-v-780fdfbe><div class="i-[heroicons-outline/book-open] mr-2" data-v-780fdfbe></div><span data-v-780fdfbe>Article</span></div></span></div><h2 class="mb-2 text-2xl font-bold tracking-tight text-[color:var(--vp-c-brand-light)] dark:text-[color:var(--vp-c-brand-dark)]"><a href="/blog/posts/JavaScript-prototype.html">JavaScript 基于原型的面向对象</a></h2><div class="mb-5 font-light"></div><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><img class="h-7 w-7 rounded-full" src="/avatar.jpg" alt="xcc"><a href="/blog/authors/ai-writer.html" class="inline-flex items-center font-medium hover:text-[color:var(--vp-c-brand-dark)]"><span class="font-medium dark:text-white">xcc</span></a></div><a href="/blog/posts/JavaScript-prototype.html" class="inline-flex items-center font-medium hover:text-[color:var(--vp-c-brand-dark)]"> Read more <div class="i-[bx/right-arrow-alt] ml-2"></div></a></div></article></div><!--]--></div></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_index.md\":\"1346bf23\",\"blog_authors_ai-writer.md\":\"9ed164e8\",\"about.md\":\"3c88ccdb\",\"blog_tags.md\":\"9c170ae6\",\"index.md\":\"6c9fab57\",\"blog_archives.md\":\"f32f0a58\",\"blog_posts_javascript-prototype.md\":\"e730ebd8\",\"blog_posts_javascript-fp.md\":\"54d74b8f\",\"blog_posts_javascript-asyc.md\":\"78c8b1a9\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"amberx\",\"description\":\"A VitePress Blog \",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"blog\":{\"defaultAuthor\":\"xcc\",\"categoryIcons\":{\"article\":\"i-[heroicons-outline/book-open]\",\"tutorial\":\"i-[heroicons-outline/academic-cap]\",\"document\":\"i-[heroicons-outline/annotation]\"},\"tagIcons\":{\"github\":\"i-[carbon/logo-github]\",\"vue\":\"i-[carbon/logo-vue]\"}},\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Blog\",\"link\":\"/\"},{\"text\":\"Tags\",\"link\":\"/blog/tags\",\"activeMatch\":\"/blog/tags\"},{\"text\":\"About\",\"link\":\"/about\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/amberxcc\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>